<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dord Roller - GM Control Panel</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="/src/styles/main.css">
</head>
<body>
  <div id="app">
    <header>
      <h1><i class="fa-solid fa-dice-d20"></i> Dord Roller - GM Panel</h1>
      <div class="header-right">
        <div id="connection-status">Disconnected</div>
        <div id="user-area"></div>
      </div>
    </header>

    <main>
      <section id="room-section">
        <h2>Room Management</h2>
        <div id="room-setup">
          <div class="create-room-form">
            <input type="text" id="room-name-input" placeholder="Room Name (e.g., Campaign Session 1)" maxlength="50">
            <button id="create-room-btn">Create New Room</button>
          </div>
          <div class="join-room-divider">— or —</div>
          <div class="join-room-form">
            <input type="text" id="room-code" placeholder="Enter Room Code to Join">
            <button id="join-room-btn">Join Room</button>
          </div>
        </div>
        <div id="room-info" style="display: none;">
          <p><strong>Room Name:</strong> <span id="current-room-name">-</span></p>
          <p><strong>Room Code:</strong> <span id="current-room-code"></span></p>
          <p id="room-id-display" class="room-id-text" style="display: none;"></p>
          <p><strong>OBS Overlay URL:</strong> <a id="obs-link" href="" target="_blank">Open Overlay</a></p>
          <div class="room-actions">
            <button id="leave-room-btn" class="leave-room-btn"><i class="fa-solid fa-door-open"></i> Leave Room</button>
            <button id="delete-room-btn" class="delete-room-btn"><i class="fa-solid fa-trash"></i> Delete Room</button>
          </div>
        </div>
      </section>

      <div class="dice-roll-row">
        <section id="dice-roller">
          <h2>Dice Roller</h2>
          
          <!-- Roll Mode Toggle -->
        <div class="roll-mode-section">
          <label>Roll Mode:</label>
          <div class="roll-mode-toggle">
            <button type="button" class="roll-mode-btn" data-mode="disadvantage" title="Disadvantage - Roll 2d20, take lowest">
              <i class="fa-solid fa-arrow-down"></i>
              <span>Disadvantage</span>
            </button>
            <button type="button" class="roll-mode-btn active" data-mode="normal" title="Normal - Roll as specified">
              <i class="fa-solid fa-dice-d20"></i>
              <span>Normal</span>
            </button>
            <button type="button" class="roll-mode-btn" data-mode="advantage" title="Advantage - Roll 2d20, take highest">
              <i class="fa-solid fa-arrow-up"></i>
              <span>Advantage</span>
            </button>
          </div>
          <p class="roll-mode-description" id="roll-mode-description">Rolling normally</p>
        </div>

        <div class="dice-fields">
          <div class="field-group">
            <label for="dice-quantity">Quantity:</label><br>
            <select id="dice-quantity">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
              <option value="16">16</option>
              <option value="17">17</option>
              <option value="18">18</option>
              <option value="19">19</option>
              <option value="20">20</option>
            </select>
          </div>
          <div class="field-group">
            <label for="dice-type">Die:</label><br>
            <select id="dice-type">
              <option value="d20">d20</option>
              <option value="d12">d12</option>
              <option value="d10">d10</option>
              <option value="d8">d8</option>
              <option value="d6">d6</option>
              <option value="d4">d4</option>
            </select>
          </div>
          <div class="field-group">
            <label for="roll-label">Action:</label><br>
            <select id="roll-label">
              <option value="">Select Action</option>
              <option value="Attack Roll">Attack Roll</option>
              <option value="Saving Throw">Saving Throw</option>
              <option value="Skill Check">Skill Check</option>
              <option value="Ability Check">Ability Check</option>
              <option value="Damage Roll">Damage Roll</option>
              <option value="Initiative">Initiative</option>
              <option value="Spell Attack">Spell Attack</option>
              <option value="Concentration Check">Concentration Check</option>
              <option value="Death Saving Throw">Death Saving Throw</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="field-group custom-action-group" id="custom-action-group" style="display: none;">
            <label for="custom-action">Custom Action:</label><br>
            <input type="text" id="custom-action" placeholder="Enter custom action..." maxlength="50">
          </div>
          <div class="field-group">
            <label for="roll-modifier">Modifier:</label><br>
            <input type="text" id="roll-modifier" placeholder="Modifier (e.g., +5 or -2)">
          </div>
        </div>
        
        <!-- Single Roll Button -->
        <div class="roll-action" style="margin-top: 15px;">
          <button id="roll-btn"><i class="fa-solid fa-dice-d20"></i> Roll Dice</button>
        </div>
        
        <div id="feedback"></div>
      </section>

      <section id="roll-log">
        <div class="roll-log-header">
          <h2><i class="fa-solid fa-scroll"></i> Roll Log</h2>
          <button type="button" id="clear-roll-log-btn" class="clear-log-btn">
            <i class="fa-solid fa-trash"></i> Clear
          </button>
        </div>
        <div id="roll-log-entries" class="roll-log-entries">
          <div class="no-rolls">No rolls yet...</div>
        </div>
      </section>
      </div>

      <section id="monster-tracker">
        <h2>Monster Tracker</h2>
        <div id="bestiary-search">
          <label for="monster-search">Monster Search:</label>
          <span class="search-help-icon" title="Click a monster name to fill the form for customization. Click the + button to instantly add the monster to your encounter.">
            <i class="fa-solid fa-circle-question"></i>
          </span>
          <br>
          <input type="text" id="monster-search" placeholder="Search bestiary by name...">
          <ul id="search-results" style="display: none;"></ul>
        </div>
        <div id="add-monster-form">
          <div class="field-group">
            <label for="monster-name">Name:</label><br>
            <input type="text" id="monster-name" placeholder="Monster Name">
          </div>
          <div class="field-group">
            <label for="monster-source">Source:</label><br>
            <input type="text" id="monster-source" placeholder="e.g., Monster Manual">
          </div>
          <div class="field-group">
            <label for="monster-type">Type:</label><br>
            <input type="text" id="monster-type" placeholder="e.g., Elemental">
          </div>
          <div class="field-group">
            <label for="monster-ac">AC:</label><br>
            <input type="number" id="monster-ac" placeholder="AC">
          </div>
          <div class="field-group">
            <label for="monster-hp">HP:</label><br>
            <input type="number" id="monster-hp" placeholder="HP">
          </div>
          <div class="field-group">
            <label for="monster-hp-max">HP Max:</label><br>
            <input type="number" id="monster-hp-max" placeholder="HP Max">
          </div>
          <div class="field-group">
            <label for="monster-hit-dice">Hit Dice:</label><br>
            <input type="text" id="monster-hit-dice" placeholder="e.g., 13d10 + 26">
          </div>
          <div class="field-group">
            <label for="monster-speed">Speed:</label><br>
            <input type="text" id="monster-speed" placeholder="e.g., 50 ft., Fly 50 ft. (hover)">
          </div>
          <div class="field-group">
            <label for="monster-str">STR:</label><br>
            <input type="number" id="monster-str" placeholder="STR score" min="1" max="30" value="10">
          </div>
          <div class="field-group">
            <label for="monster-dex">DEX:</label><br>
            <input type="number" id="monster-dex" placeholder="DEX score" min="1" max="30" value="10">
          </div>
          <div class="field-group">
            <label for="monster-con">CON:</label><br>
            <input type="number" id="monster-con" placeholder="CON score" min="1" max="30" value="10">
          </div>
          <div class="field-group">
            <label for="monster-int">INT:</label><br>
            <input type="number" id="monster-int" placeholder="INT score" min="1" max="30" value="10">
          </div>
          <div class="field-group">
            <label for="monster-wis">WIS:</label><br>
            <input type="number" id="monster-wis" placeholder="WIS score" min="1" max="30" value="10">
          </div>
          <div class="field-group">
            <label for="monster-cha">CHA:</label><br>
            <input type="number" id="monster-cha" placeholder="CHA score" min="1" max="30" value="10">
          </div>
          <div class="field-group">
            <label for="monster-skills">Skills:</label><br>
            <input type="text" id="monster-skills" placeholder="e.g., Perception +8, Stealth +10">
          </div>
          <div class="field-group">
            <label for="monster-senses">Senses:</label><br>
            <input type="text" id="monster-senses" placeholder="e.g., Darkvision 60 ft.; Passive Perception 18">
          </div>
          <div class="field-group">
            <label for="monster-languages">Languages:</label><br>
            <input type="text" id="monster-languages" placeholder="e.g., Common, Primordial (Auran)">
          </div>
          <div class="field-group">
            <label for="monster-cr">CR:</label><br>
            <input type="text" id="monster-cr" placeholder="e.g., 6 (XP 2,300; PB +3)">
          </div>
          <div class="field-group">
            <label for="monster-actions">Actions:</label><br>
            <textarea id="monster-actions" placeholder="e.g., Multiattack. The stalker makes..."></textarea>
          </div>
          <div class="field-group">
            <label for="monster-reactions">Reactions:</label><br>
            <textarea id="monster-reactions" placeholder="e.g., Opportunity Attack. The stalker makes..."></textarea>
          </div>
          <button id="add-monster-btn">Add Monster</button>
        </div>
        <div id="monster-list">
          <!-- Monster cards will be added here dynamically -->
        </div>
      </section>

      <section id="player-tracker">
        <div class="tracker-header">
          <h2><i class="fa-solid fa-users"></i> Player Tracker</h2>
          <button type="button" id="refresh-players-btn" class="refresh-players-btn">
            <i class="fa-solid fa-arrows-rotate"></i> Refresh All
          </button>
        </div>
        <div id="player-list-container">
          <table id="player-table">
            <thead>
              <tr>
                <th>Status</th>
                <th>Character</th>
                <th>Player</th>
                <th>AC</th>
                <th>HP</th>
                <th>Summary</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="player-list-body">
              <tr id="no-players-row">
                <td colspan="7" class="no-players">No players connected. Share your room code!</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Character Sheet Modal -->
      <div id="character-sheet-modal" class="modal hidden">
        <div class="modal-content character-sheet-modal-content">
          <div class="modal-header">
            <h3 id="modal-character-name">Character Sheet</h3>
            <button class="modal-close" id="sheet-modal-close">&times;</button>
          </div>
          <div class="modal-body" id="sheet-modal-body">
            <!-- Character sheet content will be populated dynamically -->
          </div>
        </div>
      </div>
    </main>
  </div>

  <script type="module" src="/src/main.js"></script>
</body>
</html>